<!doctype html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1, viewport-fit=cover">
  <meta name="theme-color" content="#ffffff">
  <link rel="manifest" href="manifest.webmanifest">
    <link rel="apple-touch-icon" href="icons/icon-light-192.svg" type="image/svg+xml">
  <title>Budget Tracker</title>
  <link rel="stylesheet" href="styles.css">
  <script type="module" src="app.js"></script>
  <script type="module" src="faceid.js"></script>
</head>
<body class="light">
  <header class="appbar">
    <button id="menuBtn" aria-label="Menu" aria-expanded="false" aria-controls="menuPanel" class="icon-btn" title="Menu">
      <span class="bars" aria-hidden="true"></span>
    </button>
    <h1>Budget Tracker</h1>
    <button id="installBtn" class="ghost" hidden type="button">Install</button>
  </header>

  <aside id="menuPanel" class="menu hidden" role="menu">
    <button type="button" data-tab="summary" role="menuitem">Summary</button>
    <button type="button" data-tab="transactions" role="menuitem">Transactions</button>
    <button type="button" data-tab="expenses" role="menuitem">Expenses</button>
    <button type="button" data-tab="creditcards" role="menuitem">Credit Cards</button>
    <button type="button" data-tab="categories" role="menuitem">Categories</button>
    <button type="button" data-tab="settings" role="menuitem">Settings</button>
    <button type="button" data-tab="importexport" role="menuitem">Import/Export</button>
    <button type="button" data-tab="help" role="menuitem">Help</button>
    <button type="button" data-tab="about" role="menuitem">About</button>
  </aside>

  <main id="view" class="container" tabindex="-1"></main>

  <template id="tpl-lock">
    <section>
      <h2>Unlock</h2>
      <div class="card">
        <p>This app is locked. Use Face ID / Touch ID to unlock.</p>
        <button id="lock-unlock" class="primary">Unlock</button>
        <p id="lock-msg" class="label"></p>
      </div>
    </section>
  </template>

  <template id="tpl-summary">
    <section>
      <h2>This Month</h2>
      <div class="card">
        <div class="row">
          <div>
            <div class="label">Spent</div>
            <div class="big" id="sum-spent">$0.00</div>
          </div>
          <div style="flex:1"></div>
          <div class="right clickable" id="sum-budget-box" tabindex="0" role="button">
            <div class="label">Budget</div>
            <div class="big" id="sum-budget">$2,000.00</div>
          </div>
        </div>
        <div class="progress"><div id="sum-progress"></div></div>
      </div>

      <div class="card" id="cap-warnings" style="display:none">
        <h3>Cap Warnings</h3>
        <ul id="cap-list"></ul>
      </div>

      <div class="card">
        <h3>Living Expenses</h3>
        <div class="row">
          <div>Allocated: <b id="exp-allocated">$0.00</b></div>
          <div style="flex:1"></div>
          <div>Remaining: <b id="exp-remaining">$0.00</b></div>
        </div>
        <button id="exp-manage" class="primary" type="button">Manage Expenses</button>
      </div>

      <div class="card" id="sum-cc-box" style="display:none">
        <h3>Credit Cards</h3>
        <ul id="sum-cc-list" class="list"></ul>
      </div>

      <div class="card">
        <h3>Recent Transactions</h3>
        <ul id="sum-tx-list" class="list"></ul>
        <button id="sum-tx-view" class="primary" type="button">View All</button>
      </div>
    </section>
  </template>

  <template id="tpl-transactions">
    <section>
      <div class="row">
        <h2>Transactions</h2>
        <button id="tx-add" class="primary" type="button">Add</button>
      </div>
      <ul id="tx-list" class="list"></ul>
    </section>
  </template>

  <template id="tpl-categories">
    <section>
      <h2>Categories</h2>
      <form id="cat-form" class="row wrap">
        <input name="name" placeholder="Name" required>
        <input name="cap" placeholder="Monthly Cap (optional)" inputmode="decimal">
        <button class="primary">Add</button>
      </form>
      <ul id="cat-list" class="list"></ul>
    </section>
  </template>

  <template id="tpl-expenses">
    <section>
      <div class="row">
        <h2>Living Expenses</h2>
        <button id="expense-add" class="primary" type="button">Add</button>
      </div>
      <ul id="expense-list" class="list"></ul>
    </section>
  </template>

  <template id="tpl-creditcards">
    <section>
      <div class="row">
        <h2>Credit Cards</h2>
        <button id="card-add" class="primary" type="button">Link</button>
      </div>
      <ul id="card-list" class="list"></ul>
    </section>
  </template>

  <template id="tpl-cardtx">
    <section>
      <div class="row">
        <h2 id="cardtx-name"></h2>
        <button id="cardtx-back" class="ghost" type="button">Back</button>
      </div>
      <ul id="cardtx-list" class="list"></ul>
    </section>
  </template>

  <template id="tpl-settings">
    <section>
      <h2>Settings</h2>
      <div class="card">
        <h3>Security</h3>
        <label class="row between"><span>Require Face ID to Unlock</span><input id="set-faceid" type="checkbox"></label>
        <button id="faceid-setup" class="ghost" type="button">(Re)Register Face ID</button>
        <p class="label">Requires HTTPS and a real domain. Face ID gates access but does not encrypt data.</p>
      </div>

      <div class="card">
        <h3>Appearance</h3>
        <label class="row between"><span>Dark Mode</span><input id="set-dark-mode" type="checkbox"></label>
      </div>

      <div class="card">
        <h3>Budget</h3>
        <label>Monthly Budget
          <input id="set-budget" inputmode="decimal">
        </label>
        <label>Start day of month
          <input id="set-startday" type="number" min="1" max="28">
        </label>
        <button id="set-save" class="primary" type="button">Save</button>
      </div>

        <div class="card">
          <h3>Quiet Hours</h3>
          <label class="row between"><span>Silence at Night</span><input id="set-quiet" type="checkbox" checked></label>
        <label>Quiet Start Hour <input id="set-qstart" type="number" min="0" max="23" value="22"></label>
        <label>Quiet End Hour <input id="set-qend" type="number" min="0" max="23" value="7"></label>
      </div>

        <div class="card">
          <h3>Diagnostics</h3>
          <button id="diag-clear" class="ghost" type="button">Clear Logs</button>
          <details>
            <summary>Logs</summary>
            <pre id="diag-logs"></pre>
          </details>
        </div>

    </section>
  </template>

  <template id="tpl-importexport">
      <section>
        <h2>Import / Export</h2>
        <div class="card">
          <button id="export-csv" class="primary" type="button">Export Transactions CSV</button>
          <input type="file" id="import-file" accept=".csv,text/csv">
        </div>
        <div class="card">
          <button id="backup-json" class="primary" type="button">Backup Data</button>
          <input type="file" id="restore-json" accept="application/json">
        </div>
      </section>
    </template>

  <template id="tpl-help">
    <section>
      <h2>Help</h2>
      <div class="card">
        <p>Use the menu to switch between sections of the app.</p>
        <ul>
          <li><b>Summary</b>: overview of spending and budget.</li>
          <li><b>Transactions</b>: view or add purchases.</li>
          <li><b>Expenses</b>: manage recurring costs.</li>
          <li><b>Categories</b>: organize where your money goes.</li>
          <li><b>Import/Export</b>: backup or restore your data.</li>
          <li><b>Settings</b>: adjust appearance and preferences.</li>
        </ul>
      </div>
      <div class="card">
        <h3>Linking Credit Card Accounts</h3>
        <p>To pull balances and transactions automatically:</p>
        <ol>
          <li>Open the <b>Credit Cards</b> tab.</li>
          <li>Press <b>Link</b>, enter your card details and paste your bank's API URL.</li>
          <li>The API URL is usually available from your bank or card provider's developer portal.</li>
          <li>Save to sync the latest credit card information.</li>
        </ol>
      </div>
    </section>
  </template>

  <template id="tpl-about">
    <section>
      <h2>About</h2>
      <div class="card">
        <p>Version: <span id="about-version"></span></p>
        <button id="about-check-update" class="primary" type="button">Check for Update</button>
        <button id="about-update" class="primary" type="button" hidden>Update and Reload</button>
      </div>
    </section>
  </template>

  <dialog id="dlg-add-tx">
    <form method="dialog" id="form-add-tx">
      <h3>Add Transaction</h3>
      <label>Amount <input name="amount" inputmode="decimal" required></label>
      <label>Date <input name="date" type="date" required></label>
      <label>Category
        <select name="category"></select>
      </label>
      <label>Note <input name="note"></label>
      <menu class="row between">
        <button id="tx-delete" class="ghost" type="button">Delete</button>
        <div>
          <button value="cancel">Cancel</button>
          <button class="primary" value="ok">Save</button>
        </div>
      </menu>
    </form>
  </dialog>

  <dialog id="dlg-edit-cat">
    <form method="dialog" id="form-edit-cat">
      <h3>Edit Category</h3>
      <label>Name <input name="name" required></label>
      <label>Monthly Cap <input name="cap" inputmode="decimal"></label>
      <menu class="row between">
        <button value="cancel">Cancel</button>
        <button class="primary" value="ok">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlg-add-expense">
    <form method="dialog" id="form-add-expense">
      <h3>Add Expense</h3>
      <label>Name <input name="name" required></label>
      <label>Amount <input name="amount" inputmode="decimal" required></label>
      <menu class="row between">
        <button id="exp-delete" class="ghost" type="button">Delete</button>
        <div>
          <button value="cancel">Cancel</button>
          <button class="primary" value="ok">Save</button>
        </div>
      </menu>
    </form>
  </dialog>

  <dialog id="dlg-link-card">
    <form method="dialog" id="form-link-card">
      <h3>Link Credit Card</h3>
      <label>Name <input name="name" required></label>
      <label>Provider <input name="provider"></label>
      <label>Balance <input name="balance" inputmode="decimal"></label>
      <label>Bank API URL <input name="bankApiUrl" type="url" placeholder="https://bank.example/api/card"></label>
      <p class="label">Paste the API endpoint from your bank to enable automatic syncing.</p>
      <menu class="row between">
        <button value="cancel">Cancel</button>
        <button class="primary" value="ok">Save</button>
      </menu>
    </form>
  </dialog>

  <dialog id="dlg-edit-budget">
    <form method="dialog" id="form-edit-budget">
      <h3>Edit Budget</h3>
      <label>Monthly Budget <input name="budget" inputmode="decimal" required></label>
      <menu class="row between">
        <button value="cancel">Cancel</button>
        <button class="primary" value="ok">Save</button>
      </menu>
    </form>
  </dialog>

</body>
</html>
